<div class="window" style="padding-top: 1.5rem;">
<link rel="stylesheet" type="text/css" href="./css/bootstrap-grid.min.css">
  <div class="window-content">
    <div class="pane-group">
	  	<div class="pane" style="padding:4rem;padding-top: 0 ">
			<h3 class="text-center"><u><span class="icon icon icon-code icon-text" style="color:#4e5851;padding-right:1rem "></span>Advanced Queries</u></h3>
			<table class="table-striped mb-2">
				<thead>
				<tr>
					<th colspan="3"><input class="form-control" type="" name="query" id="query"></th>
					<th style="width:4rem"><button class="btn btn-default" id="run">
        				<span class="icon icon-search"></span>
      				</button></th>
				</tr>
			</thead>
			</table>
			<div class ="row" style="display: flex" id='display_body'>
		
			</div>
		</div>
	</div>
</div>
</div>
<script type="text/javascript">

document.querySelector('#run').addEventListener("click", function(){
const { init_data} = require('../res/reusable');
var db = init_data(Dexie);
let torun = document.querySelector('#query').value;
const query =eval(`db.${torun}`);
let display = document.getElementById('display_body');
display.innerHTML='';      
try{
let fragment = document.createDocumentFragment();   
query.each(computer=>{
console.log(computer);
let wrapper = document.createElement('div');
wrapper.setAttribute('class','col-md-4');

let card = document.createElement('div');
card.setAttribute('style','border:1px solid silver;border-radius:15px;box-shadow: 2px 2px 0.5rem rgba(0,0,0,0.5)');
card.setAttribute('class','card m-3 pt-0 p-2');
//handle double clicks
// card.ondblclick = event => {
// 	window.data = computer;
// 	//new Tabs('./pages/edit.htm');
// 	Tabs('.header-tab','main','./mainview/edit/desktops.htm').then(()=>{
// 	document.querySelector('#edit_tab').style.display = 'block';	
// 	})
	
// }

// let card_head = document.createElement('h4');
// card_head.setAttribute('class', ' pl-2 mt-0 toolbar toolbar-header');
// card_head.setAttribute('style','border:1px solid silver;border-radius:10px;box-shadow: 2px 2px 0.5rem rgba(0,0,0,0.5)');
// let bold = document.createElement('strong');
// bold.innerHTML = computer['comp_name'];
// card_head.appendChild(bold);
// card.appendChild(card_head);






let card_body = document.createElement('div');
card_body.setAttribute('class','card-body p-0');
let list = document.createElement('ul');
list.setAttribute('class',' row m-0 p-0');
list.setAttribute('style', 'list-style: none;');
let innerfrag = document.createDocumentFragment();

i = 0;
for (const key of Object.keys(computer)) {
	if(computer[key]){
	if(key =='id' || key=='__proto__'){continue}
	else if(key == 'log'){
	let list_element = document.createElement('li');
	list_element.setAttribute('class', 'col-sm-10 m-0 p-0');
	list_element.innerHTML = `<strong>${key}</strong> : <br><pre style='color: #7fba00'>${computer[key]}</pre`;
	innerfrag.appendChild(list_element); 
	i++;
	}else{
	let list_element = document.createElement('li');
	list_element.setAttribute('class', 'col-6 m-0 p-0');
	list_element.innerHTML = ` <strong>${key}</strong> : ${computer[key]}`;
	innerfrag.appendChild(list_element);
	i++;
	}	
}else{
	i++;
}
}
list.appendChild(innerfrag);
card_body.appendChild(list);
card.appendChild(card_body);
wrapper.appendChild(card);
fragment.appendChild(wrapper);
}).then(()=>{
display.appendChild(fragment);
});

}catch(err){

let display = document.getElementById('display_body');
display.innerHTML = `Oops sorry something is wrong with your query`;
}



});

</script>