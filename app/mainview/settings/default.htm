<div class="window" style="padding-top: 1.5rem;">
  <div class="window-content">
    <div class="pane-group">
	<div class="pane" style="padding: 1rem;padding-top: 0">
		<h3><u><span class="icon icon-globe icon-text" style="color:  #7fba00;padding-right:1rem "></span>Regions</u></h3>
		<table class="table-striped" id="reg_body">
			
		</table>
		<button class="btn btn-primary pull-right" id="add_region">Add</button>      

      </div>
      <div class="pane" style="padding: 2rem;padding-top: 0">
		<h3><u><span class="icon icon-users icon-text" style="color: #ffb900;padding-right:1rem "></span>Departments</u></h3>
		<table class="table-striped" id="dept_body">
			
		</table>
		<button class="btn btn-primary pull-right" id="add_dept">Add</button>   
	</div>

      <div class="pane" style="padding: 2rem;padding-top: 0">
		<h3><u><span class="icon icon-db-shape icon-text" style="color: #00a4ef;padding-right:1rem "></span>Operating System</u></h3>
		<table class="table-striped" id="os_body">
			
		</table>

      	<button class="btn btn-primary pull-right" id="add_os">Add</button>  
      </div>

       <div class="pane" style="padding: 2rem;padding-top: 0">
		<h3><u><span class="icon icon-db-shape icon-text" style="color: #f25022;padding-right:1rem "></span>MS Office</u></h3>	 
    <table class="table-striped" id="ms_body">
			
		</table>
		<button class="btn btn-primary pull-right" id="add_ms">Add</button>
    </div>

  </div>
</div>
</div>


<script type="text/javascript">
	 const { init_data} = require('../res/reusable');
/*-------------------table body--------------------------------------------*/
var db = init_data(Dexie);
//regions
db.regions.each(result=>{
	create_table_row(result,db,'regions','#reg_body');
});

//department
db.departments.each(result=>{
	create_table_row(result,db,'departments','#dept_body');
});

//Operating System
db.os.each(result=>{
	create_table_row(result,db,'os','#os_body');
});
db.ms_office.each(result=>{
	create_table_row(result,db,'ms_office','#ms_body');
});


//
/*----------------------------------done-------------------------------------------*/

/*--------------------------Button to add more values -----------------------------*/
let buttonAdd = document.querySelector('#add_region')
buttonAdd.onclick = event => {
 	db.regions.add({
		name: '',
	}).then((id)=>{
			let fake_result = {
				id : id,
				name: ""
			};
			
			create_table_row(fake_result,db,'regions','#reg_body');
	});
}

//button 2
let buttonAdd2 = document.querySelector('#add_dept')
buttonAdd2.onclick = event => {
 	db.departments.add({
		name: '',
	}).then((id)=>{
			let fake_result = {
				id : id,
				name: ""
			};
			
			create_table_row(fake_result,db,'departments','#dept_body');
	});
}

// Button 3

let buttonAdd3 = document.querySelector('#add_os')
buttonAdd3.onclick = event => {
 	db.os.add({
		name: '',
	}).then((id)=>{
			let fake_result = {
				id : id,
				name: ""
			};
			
			create_table_row(fake_result,db,'os','#os_body');
	});
}

// Button 4
let buttonAdd4 = document.querySelector('#add_ms')
buttonAdd4.onclick = event => {
 	db.ms_office.add({
		name: '',
	}).then((id)=>{
			let fake_result = {
				id : id,
				name: ""
			};
			
			create_table_row(fake_result,db,'ms_office','#ms_body');
	});
}

/*--------------------------------------Button End-------------------------*/
















/*------------------------------------------Reusables-------------------------*/
function create_table_row(result,db,database_name,sector) {
	let tr = document.createElement('tr');
	//let td_id = document.createElement('td');
	//td_id.className="id";
	//td_id.innerHTML = window.iterate_id.number;
	let minifragment = document.createDocumentFragment();
	for (const key of Object.keys(result)) {
		if(key == '__proto__' || key ==='id'){ continue}
			let td = document.createElement('td');
			let input = document.createElement('input');
			if(result[key]) input.value = result[key];
			else input.placeholder="Type here"
			input.setAttribute("style","background-color:transparent !important; border:none !important; width:7rem");
			input.onchange = event =>{
			let value = event.target.value;
			if(value){
			let sanitized_value = parseInt(value);
			 if(isNaN(sanitized_value)){
			 db[database_name].update(result.id, {[key]:value}).catch(err=>{console.log(err)});
			}else{
				db[database_name].update(result.id, {[key]:sanitized_value}).catch(err=>{console.log(err)});
			}
			} else{
				db[database_name].update(result.id, {[key]:""}).catch(err=>{console.log(err)});
				event.target.placeholder='Type here';
			}

			}
			td.appendChild(input);
			minifragment.appendChild(td);
		}

		let td_remove = document.createElement('td');
		td_remove.innerHTML = 'Remove';
		td_remove.className ='btn btn-warning';

		td_remove.onclick = event=>{
			db[database_name].delete(result.id)
			.then(()=>{
			event.target.parentElement.remove();
			})
			  
		}	
		 //tr.appendChild(td_id);	
		 tr.appendChild(minifragment);
		 tr.appendChild(td_remove);
		 let table_body = document.querySelector(sector);
		 table_body.appendChild(tr);
		 //window.iterate_id.number = window.iterate_id.number+1;
}

/*----------increment Re-use---------*/
function id_increment(){
			let all_ids = document.querySelectorAll('.id');
			for (var incr = 0; incr < all_ids.length; incr++) {
				if(all_ids[incr].innerHTML == incr+1){continue}
				else{
					all_ids[incr].innerHTML=incr+1;
				}
			}
			window.iterate_id.number=incr+1;
}
/*--------------------------------------------------------*/
</script>